# Network-and-Graph-Theory-Analysis-of-fMRI-data

## Introduction

There is a large body of literature supporting the existence of sex differences in human cognition. For example, males tend to perform better on visuospatial and motor tasks whereas females perform better on tasks of social cognition, face recognition, and memory (Gur et al., 2012; Halpern et al., 2007). While the underlying cause of such differences has not been established, they are often thought to be driven by a combination of biological and social factors. And indeed, the question of sex differences in human brains is of importance not only in the context of differences in performance on specific tasks but also (and in complementary fashion) in the context of the differences in prevalence, symptomatology, and response to treatment of psychiatric conditions (see Riecher-Rossler, 2016). Thus, understanding how brain differences amongst sexes can influence vulnerability is of great importance.
Previous neuroimaging studies have found group-level sex differences in the brain that can be associated with behavioural differences. For instance, whole-brain structural differences have been reported in some studies whereby women were found to have an increased proportion of grey matter while men were found to have an increased proportion of white matter (Schmithorst, Holland, & Dardzinski, 2008; Gur et al., 1999; Szeszko et al., 2013). Structural differences have also been reported at the level of specific brain structures such as the amygdala, the hippocampus, and the corpus callosum (Ruigrok et al., 2014). In fact, some structural differences have been reported to be present even as early as childhood and adolescence (Leenroot et al., 2007; Wheelock et al., 2019). 
However, the human brain is more than just sets of individual regions, rather it is a complex, connected network that can be represented as a graph. The translation of such structural differences into differences in structural and functional brain connectivity is not yet well-established. Indeed, recently and with the advent of advancements made in network science and graph theory, there has been increased focus on the study of structural and functional brain networks. In the context of brain network analyses, the concept of the brain as a connectome has been proposed whereby the brain can be represented through a graph consisting of brain regions (i.e., nodes) and the connections between them (i.e., edges) (Basset & Sporns, 2017). 
Network analyses can be used to defined structural, functional, and effective connectivity (Bullmore & Sporns, 2009). Effective connectivity is related to causation and is beyond the scope of this paper. Structural connectivity is established through anatomical links, while functional connectivity is established through symmetrical statistical associations between elements of the system. In the case of functional magnetic resonance imaging (fMRI), functional connectivity can be established through the statistical association between time series of the physiological blood oxygen level-dependent (BOLD) signal from different brain areas. This is based on the assumption that brain regions which display similar temporal changes in activity are functionally connected. Moreover, graph theory can be applied to generate meaningful information regarding the topological architecture of human brain networks, such as small-worldedness. Thus, these approaches for modelling brain data, in turn, provide novel insight in the realm of brain sciences by facilitating the measurement of network properties in the brain, such as segregation, integration, or centrality.
A few studies have already employed network analyses and graph theoretical metrics to investigate differences in structural and functional connectivity between males and females using resting state fMRI data. Resting state fMRI depicts an estimate of the functional connectivity of the brain in the absence of a cognitive task; i.e., it reflects intrinsic brain connectivity. In some studies, on average, females were found to have stronger inter-hemisphere connectivity while males were fond to have intra-hemisphere connectivity (Szalkai et al. 2015; Ingalhalikar et al., 2014). In another study Weissman-Fogel et al. (2010), the authors reported no sex differences in functional connectivity in resting state fMRI data.  Thus, overall, the evidence for differences in functional brain organization between sexes is inconsistent. In fact, there is an ongoing debate in the literature as to whether there should be a strict sexually dimorphic view of the brain. For instance, Joel et al. (2015) found that there is actually an overlap between the distributions of females and males in terms of grey matter, white matter, and structural connectivity. A better understanding of differences in brain connectivity among sexes can have far-reaching implications for gender studies as well as for the statistical treatment of sex in analyses (Chekroud et al., 2016). 
The aim was to evaluate the accuracy with which a supervised machine learning model could predict sex based on resting state functional connectivity. Thus, a supervised machine learning algorithm (XGBoost) was developed to predict sex based using a combination of graph theoretical metrics and functional connectivity based on resting-state fMRI data from healthy participants. 

## Dataset Description

The dataset was taken from a recent study investigating adolescent changes in human brain functional connectivity (see Váša et al., 2020). A cohort of participants were scanned across 3 sites using identical 3T MRI systems and resting-state fMRI data were collected. Each participant was scanned several times. Details of MRI acquisition and pre-processing have been outlined in detail in the original paper (Váša et al., 2020). 
The dataset used in the study at hand consisted of functional connectivity data, age, sex, scanner site (all 3 sites), and framewise displacement. A total 132 participants whose age ranged between 14.65 and 25.78 were included. There were 71 females, and the majority of scans (75%) came from a single site (WBIC).


## Functional Connectivity and Graph Theory Metrics

The fMRI data had already been parcellated into 346 regions and functional connectivity (FC) matrices for each scan were established using Pearson’s correlations between all pairs of regional time series. Thresholding based on edge density was applied to the FC data. Subsequently, each FC matrix was averaged using the upper triangular portion of the matrix. Thus, a mean functional connectivity value was generated for each participant. Moreover, graph theory metrics were generated using Brain Connectivity Toolbox in Python (bctpy). The graph measures calculated were global efficiency and average clustering across nodes. The former refers to the average inverse shortest path length in the network and is often considered a measure of integration within a brain network. On the other hand, the clustering coefficient refers to the fraction of triangles around a node and reflects the fraction of node’s neighbours that are also neighbours of each other. Here we consider the average of clustering coefficients per participant (or equivalently per scan). 

## Machine Learning: XGBoost

An end-to-end machine learning pipeline using XGBoost (the SciKit Implementation in Python) was developed to predict sex. Input variables used in the classifier were subject-level mean functional connectivity, global efficiency, average clustering coefficient, framewise displacement, and age. The outcome variable to be predicted was sex (male or female). 
The dataset was first randomly split into a training dataset (80%) and a hold-out test set (20%). First, hyperparameter tuning was performed in the training data using 10-fold cross-validated randomised search grids. The best estimates of hyperparameters obtained through the tuning process were then fit to the entire training dataset, and the resulting parameter estimates were used to predict unseen cases in the test dataset and to evaluate the final model. The model’s performance on unseen data was evaluated using precision, recall, and accuracy.
The hyperparameters that were tuned in the model training process were the following: number of estimators (i.e., trees), the depth of the tree, the minimum number of instances needed in each node, and the learning rate. These hyperparameters were selected based on existing literature on important hyperparameters to be tuned in an XGBoost model. As this was a binary classification problem (predicting male or female), the learning objective was set as “logistic”. 
Results
A variable importance plot was generated based on the final (i.e., best model derived from fitting the hyperparameters to the whole training dataset) and the average clustering coefficient came out as the most important feature in the classifier. This was followed by mean functional connectivity, global efficiency, and framewise displacement. See Figure 1 below for more details. 
 

The model generally performed poorly with an accuracy of 0.59 indicating that it correctly labelled the scan as male or female 59% of the time in unseen cases. This is only slightly better than chance performance. Interestingly, the model seemed to perform better in predicting females as compared to men. For example, as it relates to the rate of recall, the model had fair recall performance when predicting females (73%). That is, the model correctly identifies 73% of those who are females. However, the model had very poor recall in predicting males (42% - worse than chance performance). Similarly, the model had poor precision. That is, when it predicted “female” the model was correct 61% of the time and when it predicts “male” it performed in a slightly poorer fashion with a precision of 56%.

## Discussion

The aim of this study was to use supervised machine learning approaches to determine whether functional connectivity and metrics from network analyses can be used to categorize male and female brains based on resting state fMRI data. As such an XGBoost classifier was trained to predict sex based on mean functional brain connectivity, global efficiency, average node clustering, age, and framewise displacement. The developed model performed poorly and could not consistently classify male and female brains. Notably, the model performed, albeit still poorly, slightly better at predicting females than males, and the most important feature was identified as the average clustering coefficient. 
Overall, the results from the model suggest that the functional connectivity features included cannot distinguish between male and females. However, it is important to highlight that there are a few drawbacks to the methods implemented in this study that could explain the poor performance of the predictive model. For instance, functional connectivity was averaged out across a large number of brain regions. It might be the case that generating connectivity metrics across specified regions as identified in previous literature can enhance performance. Moreover, it would be worth further exploring different features of connectivity as well as exploring differences in functional connectivity during performance of cognitive tasks for which there is evidence of sex differences in performance. Finally and as it relates to the development or training of the model, using nested-cross validation for model selection and evaluation might also improve performance. However, this was not implemented for computational efficiency purposes.


## References
Bassett, D. S., & Sporns, O. (2017). Network neuroscience. Nature neuroscience, 20(3), 353–364. https://doi.org/10.1038/nn.4502
Bullmore, E., & Sporns, O. (2009). Complex brain networks: Graph theoretical analysis of structural and functional systems. Nature Reviews Neuroscience, 10(3), 186.
Chekroud, A. M., Ward, E. J., Rosenberg, M. D., & Holmes, A. J. (2016). Patterns in the human brain mosaic discriminate males from females. Proceedings of the National Academy of Sciences of the United States of America, 113(14), E1968. https://doi.org/10.1073/pnas.1523888113
Gur, R. C., Richard, J., Calkins, M. E., Chiavacci, R., Hansen, J. A., Bilker, W. B., Loughead, J., Connolly, J. J., Qiu, H., Mentch, F. D., Abou-Sleiman, P. M., Hakonarson, H., & Gur, R. E. (2012). Age group and sex differences in performance on a computerized neurocognitive battery in children age 8-21. Neuropsychology, 26(2), 251–265. https://doi.org/10.1037/a0026712
Gur, R. C., Turetsky, B. I., Matsui, M., Yan, M., Bilker, W., Hughett, P., & Gur, R. E. (1999). Sex differences in brain gray and white matter in healthy young adults: correlations with cognitive performance. The Journal of neuroscience : the official journal of the Society for Neuroscience, 19(10), 4065–4072. https://doi.org/10.1523/JNEUROSCI.19-10-04065.1999
Halpern D (2007) The science of sex differences in science and mathematics. Psychol Sci Public Interest 8(1):1–51.
Ingalhalikar, M., Smith, A., Parker, D., Satterthwaite, T. D., Elliott, M. A., Ruparel, K., Hakonarson, H., Gur, R. E., Gur, R. C., & Verma, R. (2014). Sex differences in the structural connectome of the human brain. Proceedings of the National Academy of Sciences of the United States of America, 111(2), 823–828. https://doi.org/10.1073/pnas.1316909110
Joel, D., Berman, Z., Tavor, I., Wexler, N., Gaber, O., Stein, Y., Shefi, N., Pool, J., Urchs, S., Margulies, D. S., Liem, F., Hänggi, J., Jäncke, L., & Assaf, Y. (2015). Sex beyond the genitalia: The human brain mosaic. Proceedings of the National Academy of Sciences of the United States of America, 112(50), 15468–15473. https://doi.org/10.1073/pnas.1509654112
Lenroot, R. K., & Giedd, J. N. (2010). Sex differences in the adolescent brain. Brain and cognition, 72(1), 46–55. https://doi.org/10.1016/j.bandc.2009.10.008
Reicher-Rossler (2016). Sex and gender differences in mental disorders. The Lancet Psychiatry, 4(1), 8-9. https://doi.org/10.1016/S2215-0366(16)30348-0
Riecher-Rössler A. (2017). Sex and gender differences in mental disorders. The lancet. Psychiatry, 4(1), 8–9. https://doi.org/10.1016/S2215-0366(16)30348-0
Ruigrok, A. N., Salimi-Khorshidi, G., Lai, M. C., Baron-Cohen, S., Lombardo, M. V., Tait, R. J., & Suckling, J. (2014). A meta-analysis of sex differences in human brain structure. Neuroscience and biobehavioral reviews, 39(100), 34–50. https://doi.org/10.1016/j.neubiorev.2013.12.004
Schmithorst, V. J., Holland, S. K., & Dardzinski, B. J. (2008). Developmental differences in white matter architecture between boys and girls. Human brain mapping, 29(6), 696–710. https://doi.org/10.1002/hbm.20431
Szalkai, B., Varga, B., & Grolmusz, V. (2015). Graph Theoretical Analysis Reveals: Women's Brains Are Better Connected than Men's. PloS one, 10(7), e0130045. https://doi.org/10.1371/journal.pone.0130045
Szeszko, P. R., Vogel, J., Ashtari, M., Malhotra, A. K., Bates, J., Kane, J. M., Bilder, R. M., Frevert, T., & Lim, K. (2003). Sex differences in frontal lobe white matter microstructure: a DTI study. Neuroreport, 14(18), 2469–2473. https://doi.org/10.1097/00001756-200312190-00035
Váša, F., Romero-Garcia, R., Kitzbichler, M. G., Seidlitz, J., Whitaker, K. J., Vaghi, M. M., Kundu, P., Patel, A. X., Fonagy, P., Dolan, R. J., Jones, P. B., Goodyer, I. M., NSPN Consortium, Vértes, P. E., & Bullmore, E. T. (2020). Conservative and disruptive modes of adolescent change in human brain functional connectivity. Proceedings of the National Academy of Sciences of the United States of America, 117(6), 3248–3253. https://doi.org/10.1073/pnas.1906144117
Weissman-Fogel, I., Moayedi, M., Taylor, K. S., Pope, G., & Davis, K. D. (2010). Cognitive and default-mode resting state networks: do male and female brains "rest" differently?. Human brain mapping, 31(11), 1713–1726. https://doi.org/10.1002/hbm.20968
Wheelock, M. D., Hect, J. L., Hernandez-Andrade, E., Hassan, S. S., Romero, R., Eggebrecht, A. T., & Thomason, M. E. (2019). Sex differences in functional connectivity during fetal brain development. Developmental cognitive neuroscience, 36, 100632. https://doi.org/10.1016/j.dcn.2019.100632

